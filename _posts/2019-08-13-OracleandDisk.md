---
layout: post
title:  "오라클과디스크"
date:   2019-08-13 19:30:13 +0800
categories: 데이터베이스
tags: 오라클
comments: 1
---

### 오라클과 디스크

오라클은 DBMS(DataBase Management System)이며 데이터베이스는 오라클이 관리하는 디스크에 있는 데이터를 뜻한다. 오라클은 디스크에서 데이터를 읽어 오고 처리를 한 후 데이터를 다시 디스크에 집어 넣는다. 오라클과 디스크의 관계를 알기 위해 잠시 HDD 구조를 짚고 넘어 가자.

[참고] HDD 구조
![Disk.png]({{site.baseurl}}/assets/postimg/Disk.png)

	(1)플래터(platter)

>플래터는 스핀들 축을 중심으로 고속회전을 한다. 플래터는 비자성체(자석에 달라붙지 않으며 자화되지도 않는 재료)인 알루미늄 또는 유리 등으로 만들어지며, 그 표면은 자성체인 산화철로 막이 씌워져 있다.

	(2)스핀들(Spindle)

>플래터의 중심을 잡아주고 그 내부의 스핀들 모터로 플래터를 등속 회전 시켜준다.

	(3)헤드(Head)

>플래터 표면에 코팅된 자성체를 자화/소거하여 정보를 저장/삭제(write /delete)하거나 저장된 정보를 읽는(read) 장치이다.
헤드는 플래터 표면에 배열된 자기 입자의 자기 극성을 판독하여 데이터를 읽고 자기장을 이용해 플래터 표면의 자성 입자를 다시 배열함으로써 데이터를 기록한다.

	(4) 액추에이터 암

>헤드암은 헤드가 플래터와 약간 떠서 거리를 가질 수 있도록 간격을 유지시켜주고, 보이스코일 모터의 작동으로 인해서 헤드를 원하는 섹터로 가져다 주는 역할도 한다.


전원이 들어오면 플래터는 스핀들 축을 중심으로 고속 회전한다. 플래터가 회전하는 동안 (액추에이터에 의해) 헤드는 움직이며 위치를 찾아 이동하고(Seek) 원하는 곳에 데이터를 읽거나 쓴다.

헤드는 트랙의 첫 부분을 찾는 작업을 1초에 100번 할 수 있을 정도로 빠르게 움직인다. 또한 회전 수도 엄청나 1분에 10000번 정도 회전 한다. 하지만, 데이터를 읽기 위해 원하는 트랙을 찾는 <U>‘시크(Seek)’</U> 시간은 msec(밀리초) 단위로 굉장히 빠른 것 같지만, 메모리에 접근하는 속도인 nsec(나노초)에 비하면 굉장한 시간이 걸리는 작업이다. 따라서, 디스크 I/O 시간은 DBMS에게 필요하지만 가능한 한 줄여야 하는 작업이다.

풀 스캔(테이블의 모든 데이터를 읽어오는 것)할 때 메모리에 데이터가 없다면 시퀀셜 액세스(시작점에서 마지막까지 전부 액세스 하는 것)가 발생한다. 만약 1GB 크기의 테이블을 20MB의 전송 속도로 데이터를 모두 가져온다고 하면, 무려 50초(크기/전송속도=1000MB/20MB)가 걸리게 된다. 그래서 인덱스라는 발상이 나오게 되었다.

데이터베이스의 인덱스에는 색인할때 사용하는 키 값과 그 키가 존재하고 있는 위치가 기록되어 있다.예를 들어, 백과사전에서 ‘오리’에 대한 내용을 책에서 조사하고 싶을 때 목차에서 해당 내용이170쪽에 쓰여 있다는 것을 확인한 후 해당 페이지를 펼치면 ‘오리’에 대한 내용을 바로 얻을 수 있다.SQL도 마찬가지로 WHERE 절에 찾고 싶은 정보인 ‘오리’라고 쓰고 SELECT 뒤에 그 중 알고 싶은 항목을 적는다.
<center><span style="color:darkblue">SELECT “개요”, “종류” FROM “백과사전” WHERE “명칭” = “오리”;</span></center>

이 SQL문을 인덱스를 사용해서 처리한다면 우선 “명칭”인덱스를 조사한다. 그 결과로 ROWID(데이터가 들어가 있는 위치)를 얻을 수 있고, 그 ROWID를 통해 데이터를 읽어 온다. 읽어온 데이터 안에는 ‘오리’의 데이터가 모두 모여 있으므로 그 안에서 “개요”, “종류” 데이터를 사용자에게 반환한다. 이렇듯 인덱스는 매우 편리한 기능이다.

인덱스를 사용하면 필요한 부분만 읽어 올 수 있다. 그러나, 필요한 부분이 여러개인 경우, 그 데이터들이 디스크 위에 연속적으로 나열 되어 있는 경우는 거의 없다. 따라서, 인덱스를 사용하여 데이터를 읽어 올 때 헤드를 움직여 가며 띄엄띄엄 액세스하게 된다. 이렇게 접근하는 방식을 랜덤 액세스라고 한다. (시퀀셜 액세스와 반대의미)

접근하려는 데이터가 전체 데이터가 15%미만일 경우에만 랜덤 액세스가 유리하다고 하는 이유는 뭘까? 원하는 데이터가 한 개가 아니라 테이블의 50%라면? 테이블에 2만건의 데이터가 있고 그 중 50%인 1만건을 꺼낸다고 해보자. 한 행은 4KB라고 각하고 1초에 100회의 시크를 한다고 가정하면 랜덤 액세스로 약 100초가 걸린다.
<center><span style="color:darkorange">100s = 4KB*10000건/ 400KB(1s에 읽어 올 수 있는 데이터 양)</span></center>

시퀀셜 액세스를 사용하면 2만건 전부를 디스크에서 읽어 온다고 해도 약 4초면 끝난다.
<center><span style="color:darkorange">4s = 4Kb*10000건/ 20MB/초(전송 속도)</span></center>

즉, 모든 데이터가 아니더라도 일정 크기 이상의 데이터를 읽는다면 디스크 특성상 시퀀셜 액세스를 사용하여 풀 스캔하는 것이 더 빠르다는 것을 알 수 있다.실제로는 캐시에 데이터가 보관된 경우도 있고, 한 개의 블록에 여러 행의 데이터가 있어서 한 번의 I/O로 많은 데이터를 읽을 수도 있고 인덱스의 데이터를 디스크에서 읽어와야 하는 경우도 있기 때문에 15%가 임계치라고 단순하게 말할 수 없으니 기준 정도로만 생각 하면 좋을 것 같다.


참고 도서 : [그림으로 공부하는 오라클 구조](https://book.naver.com/bookdb/book_detail.nhn?bid=9521600)






[jekyll-docs]: https://jekyllrb.com/docs/home
[jekyll-gh]:   https://github.com/jekyll/jekyll
[jekyll-talk]: https://talk.jekyllrb.com/
